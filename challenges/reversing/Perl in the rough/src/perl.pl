#!/usr/bin/perl

# main logik actual source code

use strict;
use warnings;
use POSIX;


my %choices = (
    a => sub {return $_[0] + $_[1]},
    s => sub {return $_[0] - $_[1]},
    m => sub {return $_[0] * $_[1]},
    d => sub {return $_[0] / $_[1]},
);

my %lookup_choices = (
    '+' => 'a',
    '-' => 's',
    '*' => 'm',
    '/' => 'd',
);

# 76 358 * 75 -
my $check_secret = "76358m75s";

my $secret = "";

sub is_number {
  my $value = shift;
  return $value =~ /^\d+(\.\d+)?$/;
}

my @stack;
my $tmp;

my $exit_status = 0;
while ($exit_status == 0) {
    print ">> "; chomp(my $s1 = <STDIN>);
    my @words = split(' ', $s1);
    foreach my $word (@words) {
        if(is_number($word)) { # number
            $secret .= $word;
            push(@stack, $word+0);
        } elsif($word =~ /[+\-\/*]/) { # operator
            my $v1 = pop(@stack);
            my $v2 = pop(@stack);
            if((defined $v1) && (defined $v2)) {
                $tmp = $choices{$lookup_choices{$word}}->($v1, $v2);
                $secret .= $lookup_choices{$word};
                print "$v1 $v2 $word = $tmp. ";
                push(@stack, $tmp+0);
            }
        } elsif($word == "exit") {
            $exit_status = 1;
            last;
        }
    }
    print "\n";
}

continue {
    if($secret eq $check_secret) {
        if($tmp == -(43*631)) {
            #my $shellcode ='my$I11oIl0l=shift;if($I11oIl0l!=-(631*43)){return}$I11oIl0l=-$I11oIl0l;my$o0Iooo0="\x7E\x21\x79\x65\x73\x25\x62\x75\x74\x29\x79\x21\x7A\x73\x7C\x40\x62\x63\x75\x66\x61\x74\x6E\x58\x6F\x20\x7C\x4E\x6F\x77\x62\x75\x46\x79\x71\x65\x73\x7E\x6E\x6F\x79\x2A\x65\x3B\x73\x60";my$IlOO0o0l0="\x6E\x4F\x5D\x63\x62\x75\x74\x6E\x60\x64\x2F\x6E\x6F\x2B\x26\x79\x65\x70\x60\x73\x75\x62\x25\x2E\x62\x2A\x6E\x5C\x6E\x6F\x71\x65\x62\x75\x74\x68\x62\x29\x75\x3E\x74\x3D\x6E\x6F\x21\x7C";my$O1OIOOooo0="\x49\x2C\x6A\x34\x25\x2B\x70\x2B\x66\x2A\x65\x2B\x4A\x2C\x32\x4B\x37\x66\x72\x7D\x4B\x77\x39\x42\x6A\x3A\x7C\x7B\x75\x2B\x4C\x24\x4A\x68\x5A\x4E\x21\x39\x58\x39\x64\x27\x67\x65\x3C\x61";my$OI0llO0o0=length($o0Iooo0)<length($IlOO0o0l0)?length($o0Iooo0):length($IlOO0o0l0);my$o10Io11l001="";for(my$l0O1000l0=0;$l0O1000l0<$OI0llO0o0;$l0O1000l0++){$o10Io11l001.=chr(ord(substr($o0Iooo0,$l0O1000l0,1))^ord(substr($IlOO0o0l0,$l0O1000l0,1)))}my$Oo1lIo="";for(my$l0O1000l0=0;$l0O1000l0<$OI0llO0o0;$l0O1000l0++){$Oo1lIo.=chr(ord(substr($O1OIOOooo0,$l0O1000l0,1))^ord(substr($o10Io11l001,$l0O1000l0,1)))}print"$Oo1lIo"';
            my $shellcode ="\x34\x3b\x6a\x10\x73\x7f\x36\x0b\x22\x69\x2e\x73\x2a\x2a\x27\x3f\x36\x75\x30\x24\x66\x7d\x0b\x7f\x68\x2d\x07\x35\x72\x22\x78\x7f\x63\x71\x74\x7d\x68\x68\x7a\x6a\x6b\x67\x22\x30\x2b\x2d\x37\x3c\x37\x3f\x6a\x10\x73\x7f\x36\x0b\x22\x69\x2e\x73\x74\x66\x07\x68\x73\x21\x10\x2e\x7e\x35\x79\x23\x20\x66\x21\x69\x0b\x21\x36\x2d\x7e\x64\x60\x12\x21\x75\x0b\x05\x3a\x7c\x68\x1e\x36\x6e\x7b\x12\x21\x74\x7b\x05\x3a\x79\x6a\x1e\x36\x6b\x77\x12\x21\x74\x7c\x05\x3a\x79\x6c\x1e\x36\x6e\x76\x12\x21\x70\x77\x05\x3a\x79\x60\x1e\x36\x6b\x73\x12\x21\x75\x0f\x05\x3a\x79\x6a\x1e\x36\x6e\x01\x12\x21\x76\x7e\x05\x3a\x78\x6b\x1e\x36\x6f\x71\x12\x21\x75\x7b\x05\x3a\x78\x6f\x1e\x36\x6f\x73\x12\x21\x75\x7a\x05\x3a\x78\x1c\x1e\x36\x6c\x7a\x12\x21\x74\x08\x05\x3a\x7c\x69\x1e\x36\x6e\x01\x12\x21\x76\x0b\x05\x3a\x78\x1f\x1e\x36\x6e\x75\x12\x21\x74\x7c\x05\x3a\x79\x6c\x1e\x36\x6d\x74\x12\x21\x75\x77\x05\x3a\x79\x68\x1e\x36\x6f\x77\x12\x21\x75\x7d\x05\x3a\x79\x1c\x1e\x36\x6f\x07\x12\x21\x74\x08\x05\x3a\x79\x60\x1e\x36\x6b\x03\x12\x21\x74\x7b\x05\x3a\x7d\x1b\x1e\x36\x6e\x71\x12\x21\x74\x7e\x7b\x79\x23\x20\x66\x07\x35\x0d\x01\x69\x2d\x7e\x35\x72\x73\x7b\x1e\x36\x6f\x07\x12\x21\x76\x08\x05\x3a\x7b\x1d\x1e\x36\x6f\x71\x12\x21\x74\x7c\x05\x3a\x79\x6c\x1e\x36\x6e\x76\x12\x21\x74\x0b\x05\x3a\x78\x69\x1e\x36\x6f\x76\x12\x21\x70\x08\x05\x3a\x78\x1c\x1e\x36\x6f\x04\x12\x21\x70\x0c\x05\x3a\x7c\x6f\x1e\x36\x6e\x7b\x12\x21\x74\x7b\x05\x3a\x79\x69\x1e\x36\x6f\x72\x12\x21\x75\x7d\x05\x3a\x79\x6c\x1e\x36\x6f\x70\x12\x21\x70\x7b\x05\x3a\x7c\x1c\x1e\x36\x6f\x70\x12\x21\x70\x0f\x05\x3a\x78\x1c\x1e\x36\x6c\x01\x12\x21\x74\x0b\x05\x3a\x78\x1f\x1e\x36\x6e\x73\x12\x21\x74\x7b\x05\x3a\x78\x6b\x1e\x36\x6e\x77\x12\x21\x75\x7a\x05\x3a\x78\x61\x1e\x36\x6f\x70\x12\x21\x70\x77\x05\x3a\x79\x6c\x1e\x36\x6a\x07\x12\x21\x75\x7a\x05\x3a\x7d\x1d\x1e\x36\x6f\x07\x12\x21\x74\x08\x05\x3a\x7c\x68\x1e\x36\x6e\x01\x6c\x62\x2f\x37\x7d\x0d\x7f\x16\x0b\x01\x16\x2d\x21\x36\x72\x73\x7b\x1e\x36\x6d\x7b\x12\x21\x70\x0d\x05\x3a\x78\x18\x1e\x36\x6a\x76\x12\x21\x70\x7b\x05\x3a\x7c\x1b\x1e\x36\x6e\x72\x12\x21\x70\x0c\x05\x3a\x78\x6f\x1e\x36\x6b\x03\x12\x21\x74\x7b\x05\x3a\x7c\x1b\x1e\x36\x6d\x03\x12\x21\x70\x0d\x05\x3a\x7d\x6b\x1e\x36\x6d\x00\x12\x21\x71\x79\x05\x3a\x78\x6f\x1e\x36\x6e\x70\x12\x21\x75\x0a\x05\x3a\x7a\x1b\x1e\x36\x6e\x75\x12\x21\x71\x77\x05\x3a\x7a\x6b\x1e\x36\x6f\x03\x12\x21\x71\x0f\x05\x3a\x79\x1a\x1e\x36\x6e\x00\x12\x21\x75\x7b\x05\x3a\x7c\x1b\x1e\x36\x6d\x01\x12\x21\x70\x7a\x05\x3a\x7a\x18\x1e\x36\x6f\x7a\x12\x21\x77\x0f\x05\x3a\x7a\x1c\x1e\x36\x6b\x73\x12\x21\x71\x77\x05\x3a\x7b\x61\x1e\x36\x6a\x7b\x12\x21\x74\x7a\x05\x3a\x7c\x6e\x1e\x36\x6f\x75\x12\x21\x74\x7b\x05\x3a\x7d\x1a\x1e\x36\x6f\x73\x6c\x62\x2f\x37\x7d\x0d\x07\x69\x2e\x22\x16\x72\x21\x69\x7f\x22\x3c\x2c\x29\x2d\x2a\x66\x7d\x2d\x7e\x10\x2d\x21\x36\x72\x67\x65\x2e\x2b\x37\x25\x3a\x31\x6a\x6a\x10\x2e\x01\x16\x72\x21\x69\x2e\x7e\x70\x7d\x22\x3c\x2c\x29\x2d\x2a\x66\x7d\x2d\x7e\x10\x2d\x21\x36\x72\x67\x63\x2e\x2b\x37\x25\x3a\x31\x6a\x6a\x10\x2e\x01\x16\x72\x21\x69\x2e\x7e\x70\x79\x23\x20\x66\x21\x68\x72\x07\x36\x73\x7f\x35\x72\x7e\x68\x7f\x6c\x7b\x79\x28\x36\x30\x66\x34\x3b\x6a\x35\x72\x01\x68\x72\x7e\x69\x2e\x7e\x64\x72\x75\x7d\x2e\x7e\x16\x73\x7e\x69\x72\x22\x69\x7e\x6a\x16\x0b\x7e\x35\x2e\x01\x69\x2d\x7e\x62\x66\x22\x69\x0d\x7f\x69\x72\x7e\x35\x72\x65\x72\x6b\x35\x7d\x2d\x7f\x69\x0b\x21\x68\x73\x22\x69\x72\x7f\x77\x7f\x2d\x31\x30\x66\x36\x30\x2a\x71\x31\x3b\x3b\x31\x3a\x2b\x6a\x6a\x36\x72\x07\x36\x2d\x21\x69\x6e\x6a\x35\x72\x01\x68\x72\x7e\x69\x2e\x7e\x75\x73\x67\x70\x1c\x21\x2b\x26\x66\x2a\x37\x2c\x2a\x36\x3c\x71\x66\x07\x35\x0d\x01\x69\x2d\x7e\x35\x72\x62\x7d\x2e\x7e\x16\x73\x7e\x69\x72\x22\x69\x6e\x7f\x70\x6b\x67\x24\x2f\x37\x7d\x0d\x21\x68\x2e\x07\x36\x7f\x6c\x7b\x79\x28\x36\x30\x66\x34\x3b\x6a\x35\x72\x01\x68\x72\x7e\x69\x2e\x7e\x64\x72\x75\x7d\x2e\x7e\x16\x73\x7e\x69\x72\x22\x69\x7e\x6a\x16\x0b\x7e\x35\x2e\x01\x69\x2d\x7e\x62\x66\x22\x69\x0d\x7f\x69\x72\x7e\x35\x72\x65\x72\x6b\x35\x7d\x0d\x21\x68\x2e\x07\x36\x6c\x73\x3a\x2a\x3c\x71\x2d\x3c\x3d\x6a\x3d\x2c\x20\x3d\x2d\x30\x66\x7d\x0d\x7f\x16\x0b\x01\x16\x2d\x21\x36\x72\x62\x7d\x2e\x7e\x16\x73\x7e\x69\x72\x22\x69\x6e\x7f\x70\x6b\x10\x36\x30\x2a\x71\x31\x3b\x3b\x31\x3a\x2b\x6a\x6a\x36\x73\x7e\x10\x2d\x7f\x68\x2e\x7e\x69\x73\x62\x7d\x2e\x7e\x16\x73\x7e\x69\x72\x22\x69\x6e\x7f\x70\x6b\x67\x24\x32\x3c\x30\x2c\x3a\x7b\x66\x01\x36\x73\x22\x10\x2d\x6c";
            print "Oop, whats here... ";
            $shellcode = decrypt_shellcode($shellcode);
            #$shellcode =~ s/(.)/sprintf '\x%02x', ord $1/seg;
            $shellcode = eval "sub{ $shellcode }";
            $shellcode->($tmp);
        }
    }
}

sub decrypt_shellcode {
    my $sc = $_[0];
    my $ybn = "YBN";
    if($stack[0] != (-43*631)) {
        exit;
    }
    my $l = length($sc);
    my $x_r = "";
    for(my $i = 0; $i < $l; $i++) {
        $x_r .= chr(ord(substr($sc, $i, 1)) ^ ord(substr($ybn, ($i % 3), 1)));
    }
    return $x_r;
}
